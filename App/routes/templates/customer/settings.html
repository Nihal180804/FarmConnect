{% extends "base.html" %}
{% block content %}

<div class="max-w-4xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">Account Settings</h1>
    <p class="text-gray-700">Manage your profile and security settings</p>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Settings Navigation -->
    <div class="lg:col-span-1">
      <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
        <nav class="space-y-2">
          <button onclick="showSection('profile')" class="settings-nav-btn w-full text-left px-4 py-3 rounded-lg font-semibold transition-colors active" data-section="profile">
            <i class="fas fa-user mr-3"></i>Profile
          </button>
          <button onclick="showSection('password')" class="settings-nav-btn w-full text-left px-4 py-3 rounded-lg font-semibold transition-colors" data-section="password">
            <i class="fas fa-lock mr-3"></i>Change Password
          </button>
        </nav>
      </div>
    </div>

    <!-- Settings Content -->
    <div class="lg:col-span-2">
      
      <!-- Profile Section -->
      <div id="profile-section" class="settings-section bg-white rounded-xl shadow-lg p-8 border border-gray-200">
        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-3">
          <i class="fas fa-user-circle text-emerald-600"></i>
          Profile Information
        </h2>
        
        <form method="POST" action="{{ url_for('customer.settings') }}" class="space-y-6">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="hidden" name="action" value="update_profile">
          
          <!-- Email (Read-only) -->
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">
              <i class="fas fa-envelope text-emerald-600 mr-2"></i>Email Address
            </label>
            <input type="email" value="{{ user.Email }}" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 text-gray-700" readonly>
            <p class="text-xs text-gray-500 mt-1">Email cannot be changed</p>
          </div>

          <!-- Name -->
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">
              <i class="fas fa-user text-emerald-600 mr-2"></i>Full Name
            </label>
            <input type="text" name="name" value="{{ customer.Name }}" class="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" required>
          </div>

          <!-- Location -->
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">
              <i class="fas fa-map-marker-alt text-emerald-600 mr-2"></i>Location
            </label>
            <input type="text" name="location" value="{{ customer.Location }}" class="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" required>
          </div>

          <!-- Save Button -->
          <button type="submit" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2">
            <i class="fas fa-save"></i>
            <span>Save Changes</span>
          </button>
        </form>
      </div>

      <!-- Password Section -->
      <div id="password-section" class="settings-section bg-white rounded-xl shadow-lg p-8 border border-gray-200 hidden">
        <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-3">
          <i class="fas fa-shield-alt text-emerald-600"></i>
          Change Password
        </h2>
        
        <div class="bg-amber-50 border-l-4 border-amber-500 p-4 mb-6">
          <div class="flex items-start gap-3">
            <i class="fas fa-info-circle text-amber-600 mt-1"></i>
            <div class="text-sm text-gray-700">
              <p class="font-semibold mb-1">Password Requirements:</p>
              <ul class="list-disc list-inside space-y-1">
                <li>At least 6 characters long</li>
                <li>Keep your password secure and don't share it</li>
              </ul>
            </div>
          </div>
        </div>

        <form method="POST" action="{{ url_for('customer.settings') }}" class="space-y-6">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="hidden" name="action" value="change_password">
          
          <!-- Current Password -->
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">
              <i class="fas fa-key text-emerald-600 mr-2"></i>Current Password
            </label>
            <input type="password" name="current_password" class="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" required>
          </div>

          <!-- New Password -->
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">
              <i class="fas fa-lock text-emerald-600 mr-2"></i>New Password
            </label>
            <input type="password" name="new_password" class="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" required minlength="6">
          </div>

          <!-- Confirm New Password -->
          <div>
            <label class="block text-sm font-semibold text-gray-900 mb-2">
              <i class="fas fa-lock text-emerald-600 mr-2"></i>Confirm New Password
            </label>
            <input type="password" name="confirm_password" class="w-full px-4 py-3 border-2 border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent" required minlength="6">
          </div>

          <!-- Change Password Button -->
          <button type="submit" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-bold py-3 px-6 rounded-lg transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2">
            <i class="fas fa-shield-alt"></i>
            <span>Change Password</span>
          </button>
        </form>
      </div>

    </div>
  </div>
</div>

<script>
function showSection(sectionName) {
  // Hide all sections
  document.querySelectorAll('.settings-section').forEach(section => {
    section.classList.add('hidden');
  });
  
  // Remove active class from all buttons
  document.querySelectorAll('.settings-nav-btn').forEach(btn => {
    btn.classList.remove('active', 'bg-emerald-100', 'text-emerald-700');
    btn.classList.add('text-gray-600', 'hover:bg-gray-100');
  });
  
  // Show selected section
  document.getElementById(sectionName + '-section').classList.remove('hidden');
  
  // Add active class to clicked button
  const activeBtn = document.querySelector(`[data-section="${sectionName}"]`);
  activeBtn.classList.add('active', 'bg-emerald-100', 'text-emerald-700');
  activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
}

// Initialize
showSection('profile');
</script>

<style>
.settings-nav-btn {
  @apply text-gray-600 hover:bg-gray-100;
}
.settings-nav-btn.active {
  @apply bg-emerald-100 text-emerald-700;
}
</style>

{% endblock %}
