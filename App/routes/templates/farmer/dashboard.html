{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
  <!-- Page Header -->
  <div>
    <h1 class="text-4xl font-bold text-gray-900">Farmer Dashboard</h1>
    <p class="text-gray-700 mt-2">Welcome back!</p>
  </div>

  <!-- Metrics Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Total Products -->
    <div class="bg-gradient-to-br from-emerald-500 to-teal-500 rounded-xl shadow-lg border border-gray-200 p-6 text-white">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Total Products</h3>
        <i class="fas fa-boxes text-3xl opacity-50"></i>
      </div>
      <div class="text-4xl font-bold">{{ overview.TotalProducts or 0 }}</div>
      <p class="text-emerald-100 text-sm mt-2">Products listed</p>
    </div>

    <!-- Total Stock -->
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg border border-gray-200 p-6 text-white">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Total Stock</h3>
        <i class="fas fa-warehouse text-3xl opacity-50"></i>
      </div>
      <div class="text-4xl font-bold">{{ overview.TotalStock or 0 }}</div>
      <p class="text-blue-100 text-sm mt-2">Units available</p>
    </div>

    <!-- Total Orders -->
    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg border border-gray-200 p-6 text-white">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Total Orders</h3>
        <i class="fas fa-shopping-cart text-3xl opacity-50"></i>
      </div>
      <div class="text-4xl font-bold">{{ overview.TotalOrders or 0 }}</div>
      <p class="text-purple-100 text-sm mt-2">Orders received</p>
    </div>

    <!-- Total Revenue -->
    <div class="bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl shadow-lg border border-gray-200 p-6 text-white">
      <div class="flex items-center justify-between mb-2">
        <h3 class="text-lg font-semibold">Total Revenue</h3>
        <i class="fas fa-rupee-sign text-3xl opacity-50"></i>
      </div>
      <div class="text-3xl font-bold">₹{{ overview.TotalRevenue or '0.00' }}</div>
      <p class="text-amber-100 text-sm mt-2">Revenue generated</p>
    </div>
  </div>

  <!-- Stock Alerts -->
  {% if overview.LowStockCount > 0 or overview.OutOfStockCount > 0 %}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% if overview.OutOfStockCount > 0 %}
    <div class="bg-red-50 border-2 border-red-300 rounded-xl p-6">
      <div class="flex items-center gap-3">
        <i class="fas fa-exclamation-triangle text-red-600 text-3xl"></i>
        <div>
          <h3 class="text-xl font-bold text-red-900">Out of Stock Alert!</h3>
          <p class="text-red-700 mt-1">{{ overview.OutOfStockCount }} product(s) are out of stock</p>
          <a href="{{ url_for('farmer.products') }}" class="inline-block mt-3 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-semibold transition-colors">
            <i class="fas fa-plus mr-2"></i>Restock Now
          </a>
        </div>
      </div>
    </div>
    {% endif %}
    
    {% if overview.LowStockCount > 0 %}
    <div class="bg-amber-50 border-2 border-amber-300 rounded-xl p-6">
      <div class="flex items-center gap-3">
        <i class="fas fa-exclamation-circle text-amber-600 text-3xl"></i>
        <div>
          <h3 class="text-xl font-bold text-amber-900">Low Stock Warning</h3>
          <p class="text-amber-700 mt-1">{{ overview.LowStockCount }} product(s) running low (≤10 units)</p>
          <a href="{{ url_for('farmer.products') }}" class="inline-block mt-3 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg text-sm font-semibold transition-colors">
            <i class="fas fa-eye mr-2"></i>View Products
          </a>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Charts Section -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Top Products Chart -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-4">Top Products</h3>
      <canvas id="topProductsChart" height="120"></canvas>
    </div>

    <!-- Additional Stats -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-4">Quick Stats</h3>
      <div class="space-y-4">
        <div class="flex justify-between items-center pb-3 border-b border-amber-200">
          <span class="text-gray-700">Best Selling Product</span>
          <span class="font-bold text-emerald-600">{% if products %}{{ products[0].ProductName }}{% else %}N/A{% endif %}</span>
        </div>
        <div class="flex justify-between items-center pb-3 border-b border-amber-200">
          <span class="text-gray-700">Highest Revenue</span>
          <span class="font-bold text-emerald-600">₹{% if products %}{{ products[0].ProductRevenue }}{% else %}0{% endif %}</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-700">Active Listings</span>
          <span class="font-bold text-blue-600">{{ overview.TotalProducts or 0 }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
    <div class="p-6 border-b border-amber-200">
      <h3 class="text-xl font-bold text-gray-900">Products Table</h3>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white">
          <tr>
            <th class="px-6 py-4 text-left text-sm font-semibold">Product</th>
            <th class="px-6 py-4 text-left text-sm font-semibold">Price</th>
            <th class="px-6 py-4 text-left text-sm font-semibold">Stock</th>
            <th class="px-6 py-4 text-left text-sm font-semibold">Units Sold</th>
            <th class="px-6 py-4 text-left text-sm font-semibold">Revenue</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-amber-200">
          {% for p in products %}
          <tr class="hover:bg-amber-50 transition-colors">
            <td class="px-6 py-4 text-gray-900 font-medium">{{ p.ProductName }}</td>
            <td class="px-6 py-4 text-gray-900">₹{{ p.Price }}</td>
            <td class="px-6 py-4">
              <div class="flex items-center gap-2">
                <span class="font-bold text-lg {% if p.QuantityAvailable == 0 %}text-red-600{% elif p.QuantityAvailable <= 10 %}text-amber-600{% else %}text-green-600{% endif %}">
                  {{ p.QuantityAvailable }}
                </span>
                {% if p.QuantityAvailable == 0 %}
                <span class="px-2 py-0.5 bg-red-100 text-red-700 rounded text-xs font-bold">OUT</span>
                {% elif p.QuantityAvailable <= 10 %}
                <span class="px-2 py-0.5 bg-amber-100 text-amber-700 rounded text-xs font-bold">LOW</span>
                {% endif %}
              </div>
            </td>
            <td class="px-6 py-4 text-gray-900">{{ p.TotalUnitsSold }}</td>
            <td class="px-6 py-4 text-gray-900 font-bold">₹{{ p.ProductRevenue }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const ctx = document.getElementById('topProductsChart').getContext('2d');
  const labels = {{ products|map(attribute='ProductName')|list|tojson }};
  const data = {{ products|map(attribute='ProductRevenue')|list|tojson }};
  new Chart(ctx, {
    type: 'bar',
    data: { 
      labels, 
      datasets:[{ 
        label:'Revenue (₹)', 
        data,
        backgroundColor: '#10b981',
        borderColor: '#059669',
        borderWidth: 2
      }]
    },
    options: { 
      responsive:true,
      plugins: {
        legend: {
          labels: {
            color: '#111827',
            font: { weight: 'bold' }
          }
        }
      },
      scales: {
        y: {
          ticks: { color: '#111827' },
          grid: { color: '#fed7aa' }
        },
        x: {
          ticks: { color: '#111827' },
          grid: { color: '#fed7aa' }
        }
      }
    }
  });
});
</script>

{% endblock %}
